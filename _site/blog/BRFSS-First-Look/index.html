<!DOCTYPE html>
<html>
  <head>
    <title>Smoking Cohort Explorations - BRFSS data – gdfe.co – Putting words on <del>paper</del> the internet</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="I’m trying to build a age-period-cohort model of smoking using the
various MPC cleaned datasets. Since I have the most experience with
BRFSS, I started with just some simple visualizations looking at the
data through a cohort lense. Things run a bit slow to use srvyr or
survey functions to get estimates of variance, so I’ll just use weighted
means and rely on inter-year variability to show the variation (at least
for now, for this exploratory work).

" />
    <meta property="og:description" content="I’m trying to build a age-period-cohort model of smoking using the
various MPC cleaned datasets. Since I have the most experience with
BRFSS, I started with just some simple visualizations looking at the
data through a cohort lense. Things run a bit slow to use srvyr or
survey functions to get estimates of variance, so I’ll just use weighted
means and rely on inter-year variability to show the variation (at least
for now, for this exploratory work).

" />
    
    <meta name="author" content="gdfe.co" />

    
    <meta property="og:title" content="Smoking Cohort Explorations - BRFSS data" />
    <meta property="twitter:title" content="Smoking Cohort Explorations - BRFSS data" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link rel="alternate" type="application/rss+xml" title="gdfe.co - Putting words on <del>paper</del> the internet" href="/feed.xml" />
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

  </head>

  <body>
    
    
    <div class="intro-header"> 
       <div class="wrapper-masthead">
         <div class="container">
           <header class="masthead clearfix">
             <div class="site-info">
               <h1 class="site-name"><a href="/">gdfe.co</a></h1>
               <p class="site-description">Putting words on <del>paper</del> the internet</p>
             </div>
             <nav>
               <a href="/">About</a>
               <a href="/blog">Blog</a>
               <a href="/projects">Projects</a>
             </nav>
             </header>
             <div class="post-heading">
              <h1>Smoking Cohort Explorations - BRFSS data</h1>
              <span class="meta">Posted by <a href="/about"> Greg
                </a> on April  2, 2017
                <br><br><a href="/">Return to Blog</a>
              </span>
            </div>
         </div>
       </div> 
    </div>

    

    <div id="main" role="main" class="container">
      <article class="post">


  <div class="entry">
    <p>I’m trying to build a age-period-cohort model of smoking using the
various MPC cleaned datasets. Since I have the most experience with
BRFSS, I started with just some simple visualizations looking at the
data through a cohort lense. Things run a bit slow to use srvyr or
survey functions to get estimates of variance, so I’ll just use weighted
means and rely on inter-year variability to show the variation (at least
for now, for this exploratory work).</p>

<p>I think the best graphs come from the most simple variable whether the
respondent has smoked 100 cigarettes total in their lifetime. Here they
are in gif form:
<img src="/images/blog/2017-04-02/unnamed-chunk-2-1.gif" alt="" /></p>

<p>If that gif makes your head swim, here’s a faceted graph showing every
5th cohort’s trends.</p>

<p><img src="/images/blog/2017-04-02/unnamed-chunk-3-1.png" alt="" /></p>

<p>I see 4 phases of broad trends:</p>

<ol>
  <li>
    <p><strong>Not enough data (Roughly 1890-1905)</strong><br />
At first there’s just not enough data and so there’s too much
variation to see any clear trends. BRFSS doesn’t have a lot of
people in the older age groups. A big part of this is due to people
dying, but also the BRFSS sample frame doesn’t cover nursing homes
or long-term care facilities so it’s coverage of older respondents
is pretty poor. Further, to make this anaysis as simple as possible,
I don’t include respondents in the top-coded age categories (97 in
1984, 80 in 2012 and later, and 99 in all other years).</p>
  </li>
  <li>
    <p><strong>Differential mortality &amp; women catch up (Roughly 1905-1935)</strong><br />
Because we are looking at ever smoking, the fact that the slope goes
down is somewhat confusing. For each person, they can never change
from an ever smoker to a never smoker. Yet, the percentage of the
cohort who are ever smokers goes down in this period. This is
self-reported data of course, so some of it could be changes in
recall or social desirability bias as time goes on, but a big part
of it is likely due to the fact that there is differential mortality
between people who have ever smoked and those who have not. This can
be caused both by the harmful effects of smoking as well as other
behaviors that are correlated with smoking such as alcohol and other
drugs and other risk behaviors.</p>

    <p>Another interesting thing to look at in this phase of the gif is that
women are catching up to men in smoking prevalence. Presumably this is
evidence of women’s liberation and other changes in social norms around
women’s behavior.</p>
  </li>
  <li>
    <p><strong>Rates fall, and men converge to women (Roughly 1935-1965)</strong><br />
After generally increasing (probably partly due to differential
mortality), the rates begin to fall pretty quickly cohort birth year
over year. At the beginning of this phase, ~75% of men and 60% of
women have ever smoked, and by the end they are below 50%.</p>
  </li>
  <li>
    <p><strong>Seeing introduction of smoking (1965-2013)</strong> 
These groups are the first that we are seeing young enough for 
significant numbers of new ever smokers to be introduced (both because 
they are younger when the first survey interviewed them and because the age of smoking introduction is getting older). This is shown by the 
upward trend for each cohort. It appears like men are starting to smoke 
more than women again, though there’s not enough data to be completely 
sure.</p>
  </li>
</ol>

<hr />

<p>Those are the first set of graphs I made from BRFSS. Hopefully soon I’ll
show something about currently smoking and retrospective prevalence from
BRFSS as well as some of the other surveys we have harmonized (YRBSS,
NSDUH, NHIS).</p>

<p>I can’t really share the data yet (hopefully soon), but here’s the code
used to produce these plots (man it’d be nice to have collapsible code
blocks in this blog CMS).</p>

<div class="highlighter-rouge"><pre class="highlight"><code>suppressPackageStartupMessages({
  library(dplyr)
  library(gganimate) # requires devtools::install_github("gergness/gganimate@1d611fa")
  library(ggplot2)
  library(mpctools)
  library(purrr)
  library(readr)
  library(srvyr)
  library(tibble)
  library(tidyr)
})

# Load data ---------
out_dir &lt;- "~/smoking_age_cohort/interim_data/"
brfss_years &lt;- 1984:2013

calc_age_clean &lt;- function(age, year) {
  # NAs for top code because we don't know their real age...
  ifelse((year == 1984 &amp; age &gt;= 97) |
           (year &gt;= 1985 &amp; year &lt;= 2012 &amp; age &gt;= 99) | 
           (year == 2013 &amp; age &gt;= 80), 
         NA, age)
  
}

all_brfss &lt;- map_df(brfss_years, function(yyy) {
  out &lt;- readRDS(paste0(out_dir, "/person/brfss", yyy, "a.Rds")) %&gt;%
    set_names(tolower(names(.))) %&gt;% 
    mutate(
      age = as.numeric(age), 
      age_clean = calc_age_clean(age, yyy),
      cohort = yyy - age_clean,
      sex = haven::as_factor(sex), 
      survey_year = yyy
    ) %&gt;% 
    filter(!is.na(age_clean))
  
  # Get weights
  if (yyy &lt;= 2010) {
    out &lt;- mutate(out, weights = landwt)
  } else {
    out &lt;-  mutate(out, weights = llcpwt)
  }   
  
  out
})


# Calcualte ever Smoked -------------
calc_smokev_bin &lt;- function(smokev) {
  smokev == 2
}

ever_smoked_data &lt;- all_brfss %&gt;%
  mutate(
    smokev_bin = calc_smokev_bin(smokev), 
    year = survey_year
  ) %&gt;%
  group_by(sex, age_clean, cohort, year) %&gt;%
  summarize(
    ever_smoked = weighted.mean(smokev_bin, weights, na.rm = TRUE), 
    n = sum(!is.na(smokev_bin))
  )

# Animated plot ------------
ever_smoked_plot_data &lt;- ever_smoked_data %&gt;% 
  # To make graphs more readable
  filter(cohort &gt; 1905)
plot &lt;- ggplot(
  ever_smoked_plot_data, 
  aes(x = year, y = ever_smoked, group = paste0(sex, "-", cohort), color = sex, 
      frame = cohort, cumulative = TRUE, alpha_decay = function(x) exp(-x/5))
) + 
  geom_line() +
  geom_point() +
  theme_bw() + 
  scale_color_manual(values = c("#984ea3", "#ff7f00")) + 
  scale_y_continuous("Ever smoked", labels = scales::percent) + 
  labs(
    title = "Cohort: ",
    subtitle = "Prevalence of ever smoking", 
    caption = "Data: BRFSS 1984-2013"
  )

gg_animate(plot, interval = 0.15)

# Static plot ------------
ever_smoked_plot_data &lt;- ever_smoked_data %&gt;% 
  # To make graphs more readable
  filter(cohort %in% seq(1905, 2005, by = 5))
  
ggplot(ever_smoked_plot_data, aes(x = year, y = ever_smoked, group = sex, color = sex)) + 
  geom_line() +
  geom_point() +
  facet_wrap(~cohort) + 
  theme_bw() + 
  scale_color_manual(values = c("#984ea3", "#ff7f00")) + 
  scale_y_continuous("Ever smoked", labels = scales::percent) + 
  labs(
    title = "Prevalence of ever smoking by cohort (every 5th year)", 
    caption = "Data: BRFSS 1984-2013"
  )
</code></pre>
</div>

  </div>

  
</article>


    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
            <div class="svg-icon">
          
<a href="mailto:gdfe.co.mail@gmail.com"><i class="icon-envelope icon-2x"></i></a>


<a href="https://github.com/gergness"><i class="icon-github icon-2x"></i></a>




<a href="https://www.twitter.com/gregfreedman"><i class="icon-twitter icon-2x"></i></a>



            </div>
        </footer>
      </div>
    </div>


    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-81635172-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/blog/BRFSS-First-Look/',
		  'title': 'Smoking Cohort Explorations - BRFSS data'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>